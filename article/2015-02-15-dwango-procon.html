<!doctype html>
<html>
<head>

<title>
本の虫: Dwangoプログラミングコンテストの感想
</title>


<link rel="stylesheet" type="text/css" href="../css/default.css" ></link>

<style type="text/css">
</style>

<!-- highlight.js -->
<link rel="stylesheet" type="text/css" href="../css/github.css"></link>
<script type="text/javascript" src="../js/highlight.pack.js"></script>
<script type="text/javascript">hljs.initHighlightingOnLoad();</script>

<!-- mathjax CDN -->
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


</head>

<body>

<header>
<h1><a href="http://cpplover.blogspot.jp/">本の虫</a></h1>


<p>
著者：江添亮<br>
ブログ: <a href="http://cpplover.blogspot.jp/">http://cpplover.blogspot.jp/</a><br>
メール: boostcpp@gmail.com<br>
Twitter: <a href="https://twitter.com/EzoeRyou">https://twitter.com/EzoeRyou</a><br>
GitHub: <a href="https://github.com/EzoeRyou">https://github.com/EzoeRyou</a>
</p>
<p>
<a href="http://www.amazon.co.jp/registry/wishlist/1X43J4K0NJVHK">アマゾンの江添のほしい物リスト</a>を著者に送るとブログ記事のネタになる
</p>

<p>
筆者にブログのネタになる品物を直接送りたい場合、住所をメールで質問してください。
</p>
</header>


<article>
<h1><a href="http://cpplover.blogspot.jp/2015/02/dwango.html">Dwangoプログラミングコンテストの感想</a></h1>


<p>
2016年2月14日、<a href="http://info.dwango.co.jp/saiyo/procon2016/">dwangoプログラミングコンテスト2016</a>が行われた。「ドワンゴからの挑戦状」というタイトルもつけられている。
</p>

<p>
今回の競技プログラミングの参加者は、1月24日に行われた予選を勝ち残った、2016年度新卒予定者から上位20名、一般から上位10名の者である。予選では、以下のような問題が出された。
</p>

<p>
<a href="http://dwango2015-prelims.contest.atcoder.jp/">Welcome to dwangoプログラミングコンテスト - dwangoプログラミングコンテスト | AtCoder</a>
</p>

<p>
この予選が終わった後で、筆者が予選問題を試みた結果が以下である。
</p>

<p>
<a href="http://cpplover.blogspot.jp/2015/01/blog-post_28.html">本の虫: ドワンゴのプログラミングコンテストをクリアできなかったお話</a>
</p>

<p>
筆者は、C問題のゲーマーじゃんけんの期待値計算が分からなかったので、バカにでも書けるモンテカルロ法を使い、力技で解こうと試みたが、少数点6桁という圧倒的に高い精度が要求されているため、必要な精度が出ずに敗北した。後に聞くところによると、問題で要求される精度をモンテカルロ法で出すには、1兆回ぐらいの試行回数が必要で、制限時間が2分であることを考えると、一回の試行辺り0.12ナノ秒しかかかってはならない計算になる。モンテカルロ法では不可能だ。とはいえ、入力がたったの98通りしかないので、答えを埋め込んむという手もあるのだが。
</p>

<p>
問題を解くだけでも難しいのに、予選はたったの2時間しか与えられていなかった。見事予選を突破した30人は、一体どのくらいの問題をクリアしたのであろうか。
</p>

<p>
まず、16新卒枠の20人は、C問題までは通過し、残りのDE問題で部分点まで取れたものが残ったようだ。一般人枠の10名は、D問題も完全に通過することが必要だったようだ。2時間で全問通過した参加者は、たったの一人だった。また、今回は、ドワンゴ社員の代表として、Kusanoが参戦することになった。予選の成績から評価すると、16新卒枠の20人には入れる実力がある。
</p>

<p>
さて、本線の問題は、以下から挑戦することが出来る。
</p>

<p>
<a href="http://dwango2015-honsen.contest.atcoder.jp/">Welcome to dwangoプログラミングコンテスト - dwangoプログラミングコンテスト | AtCoder</a>
</p>

<p>
さて、当日の話をしよう。私は当日、非常に眠かった。というのも、プロコンの前日はちょうど金曜日である。花金である。ドワンゴでは、金曜日の夜は大抵ボードゲームが行われる。もちろん、金曜日以外にも突発的にボードゲームは行われるのだが、金曜日の夜は、ドワンゴでボードゲームのかからない日はないといってよい。金曜日も、会社の設備であるセミナールームを借りて、徹夜でボードゲームをしていた。カタン、カルカッソンヌ、キングオブトーキョー等など。そのため、プロコンが行われた会場であるセミナールームは、当日の朝まで大量のボードゲームが散らかっていたのであった。
</p>

<p>
さて、その徹夜ボードゲームの最中に、私がプロコンの懇親会のメンバーに入っていると、同僚から聞かされた。社内のスケジュール管理システムをみてみると、なるほど、確かに予定が追加されている。すでに午前0時を回っているので、私が知ったのは当日ということになる。タダ飯であり、しかも勤務扱いになるそうだ。
</p>

<p>
懇親会は夜なので、とりあえず午前中は歌舞伎を見て過ごし、午後になってから、会場となるセミナールームに顔を出してみると、すでに机が配置されていて、準備があらかた整っていた。机にはお菓子と飲み物が置いてあった。そして、前方に大量のきのこの山とたけのこの里・・・まさか、ここでおっ始めるつもりか。戦争を！
</p>

<p>
さて、その後は問題通過を示す風船を膨らますなどの作業をしていると、時間よりやや早く、人がやってきた。参加者であろうか。いや違う。これこそ世に隠れもなきAtCoderの<a href="https://twitter.com/chokudai">高橋 直大(chokudai)</a>御仁であった。この仁について、筆者がここで筆を弄して拙い紹介めいた文章を書く必要はないものと信ずる。
</p>

<p>
さて、御仁から、今回の問題を早々と見せてもらったが、白状すると、一番簡単であるべき<a href="http://dwango2015-honsen.contest.atcoder.jp/tasks/dwango2015_finals_1">A問題：ニコニコ文字列２</a>ですら、筆者には解答方法が皆目見当がつかぬ。chokudai御仁によると、A問題は、今日来ている全員が正解するであろうとのことであった。全問正解はかなり難しいのではとも言っていた。
</p>

<p>
さて、そうこうしているうちに、参加者がぼつぼつ集まってきた。今回の予選を突破した参加者は、若い人は高校生。遠い人はなんと韓国からやってきている韓国人であった。そして、全員が男であった。一体、プログラマーにおけるいびつな男女比はなぜであろうか。やはり、まだ社会的な理由があるのであろうか。
</p>

<p>
筆者は、参加者の持ち込み物に注目してみた。本を持ち込んでいる者がいたが、なぜか皆、まったく同じ本を持ち込んでいる。一体あの本は何なのか。筆者は同じくドワンゴ社員であり、<a href="http://dwango2015-prelims.contest.atcoder.jp/tasks/dwango2015_prelims_3">問題C: ゲーマーじゃんけん</a>の問題作成をしたtayamaにたずねてみた。
その本は<a href="http://www.amazon.co.jp/gp/product/4839931992/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4839931992&linkCode=as2&tag=boostcpp-22">プログラミングコンテストチャレンジブック</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=boostcpp-22&l=as2&o=9&a=4839931992" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />、通称をアリ本といい、競技プログラマーの間では知らぬ者のない名著であるという。また、chokudai御仁も、
<a href="http://www.amazon.co.jp/gp/product/4797367172/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=4797367172&linkCode=as2&tag=boostcpp-22">最強最速アルゴリズマー養成講座 プログラミングコンテストTopCoder攻略ガイド</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=boostcpp-22&l=as2&o=9&a=4797367172" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />という参考書を出しているそうだ。
</p>

<p>
6面ダイスを持ち込んでいる者もいた。tayamaによれば、もしダイスを使う問題が出てきた場合、問題の解法を考える際に、実際に回転させられる物理的なダイスがあると便利なのだという。あるプログラミングコンテストで、20面ダイスを使う問題が出てきたのだが、そんな珍しいダイスまで持ちあわせていない会場の参加者の中には、問題用紙に印刷された20面ダイスの展開図を切り取って組み立てはじめる者までいたそうだ。その中で、唯一20面ダイスを持ち込んだチームがいたのだが、そのチームは、せっかく持ち込んだダイスには目もくれず、さっさと頭の中だけで考えて問題を解いたそうだ。なかなか寓話めいた話である。
</p>

<p>
他には、物理的な紙とペンを用意している人も多かった。
</p>

<p>
肝心のコンピューターであるが、ラップトップ一台だけを持ち込んだ者がほとんどであった。マウスを持ち込んでいる者はそれなりにいたが、意外にもキーボードを持ち込んでいる者は少なかった。ディスプレイを持ち込んだ猛者はいなかった。
</p>

<p>
ちらっと眺めたところ、WindowsでもMacでもないOSとしては、UbuntuのUnityが目立った。それ以外のDEを使っている参加者もいたような気がする。
</p>

<p>
今回のドワンゴのプログラミングコンテストは、AtCoder社のシステムを使い、問題作成もAtCoder社に依頼したと聞いている。現在主流の競技プログラミングのシステムは、Webブラウザー上から、コードを提出し、サーバー側で実行される。競技プログラミングというのは、入力が与えられ、問題から期待される出力を返せば、テストに通過する。競技プログラミングには、正しい出力という条件以上に、最大の実行時間やメモリ使用量などがあらかじめ設定されている。
</p>

<p>
AtCoderのシステムでは、かなり多くの言語(なんとBashまである)を用いることができるが、今回の参加者は、一人を除いて皆、C++11を使った。一人はJavaを使った。
</p>

<p>
なぜC++を使うのか。競技プログラミングコンテストは様々あるが、大抵の競技プログラミング用のシステムは、C++はまずサポートしているというのがある。標準ライブラリで著名なデータ構造やアルゴリズムは網羅している。また、実行速度の問題もある。AtCoderのシステムと問題は、言語によって制限時間を変えることがないので、pythonやrubyやphpのようなネイティブコードにコンパイルしない言語は、その分不利となる。
</p>

<p>
ちなみに、chokudai御仁はC#を使うという。これは、彼の初めて参加した競技プログラミング大会が、Microsoftが主催したものであり、言語がC#限定であったからだという。また、御仁が始めた書いたプログラムは、競技プログラミングの問題に対する解答であり、hello,worldをすっ飛ばし、ifもforも知らない状態で千行ほどのCのコードを書いたという。
</p>

<p>
プログラミングの目的は様々ある。ソフトウェアを作ることが目的の者もいれば、プログラミング自体に楽しみを覚える人間もいる。しかし、今回のプログラミングコンテストの参加者は、競技プログラミングに回答するためにプログラミングをしているという者がいる。何と純粋な動機だろうか。
</p>

<p>
ちなみに、当日の参加者におけるきのこの山とたけのこの里であるが、どうやら勢力は拮抗していたように思われる。
</p>

<p>
さて、競技が始まった。我々は別室にて、AtCoderの管理用のアカウントを用いて様子を見ていた。最初の数分は、何の提出もない。当然だ。まず少なからぬ文章量の問題を読む必要があり、次に書く必要がある。
</p>

<p>
開始から6分6秒にして、A問題の通過者が現れた。驚くべき速さである。問題を理解するのにすら時間がかかり、解凍方法が思い浮かばない筆者としては、呆然とするしかないのだが、chokudai御仁からすれば、「まあ、解く人は解くでしょ。もちろん、すごい速いし難しいことに変わりはないけれど」と落ち着き払った様子。どうやら生きている世界が違うようだ。
</p>

<p>
やや時間が経過するが、A問題通過者はそれほど増えない。普段の実力を考えれば、そろそろ解いていてもおかしくない人たちが一度も提出に至らない。どうやら、たったの20点というA問題の配点を見て、後回しの判断をした可能性があるという。今回のプログラミングコンテンストは、たったの2時間である。ただ解けるだけではなく、このような戦略も必要になってくるのだという。
</p>

<p>
競技開始から一時間を経過したところで、ニコ生を行うことにした。ただ、後から考えると、競技開始と同時にニコ生を行ったほうが、「おお、6分6秒で最初の通過者！」などと実況ができて面白かったように思う。ドワンゴの@mesoとAtCoderの@chokudaiとドワンゴのtayamaと、ゲリラ的に筆者も出た。
</p>

<p>
<a href="http://live.nicovideo.jp/gate/lv210224851">dwangoプログラミングコンテスト「ドワンゴからの挑戦状」本選 - 2015/02/14 17:00開始 - ニコニコ生放送</a>
</p>

<p>
色々と話はあったが、テキストエディターの宗派が全員違ったのは、なかなか興味深かった。chokudai御仁はVisual Studioを使っている。@mesoはSublime Textを、tayamaはEmacsを、筆者はVimを使っている。
</p>

<p>
さて、競技時間が残り少なくなってきた。
</p>

<p>
順位を見ると、A問題を通過して、BCを完全解答なりほぼ完全に近い部分点を取得をした人が上位に来ていた。<a href="http://dwango2015-honsen.contest.atcoder.jp/tasks/dwango2015_finals_4">D問題のコインの取り合い</a>はなかなか通過する人がいない。ただし、部分点の10点を取得する人が出てきた。この10点は結構大きく、ABCを完全回答した上位者の中で、部分点10点によりさらに上位に位置する人が出てきた。ただし、部分点とはいえ、落書き回数0の場合も相当に難しいのだが。
</p>

<p>
順位表と各問題の配点を見ると、まだ、D問題を完全通過すれば、一発逆転のチャンスが残っているようだ。D問題さえできれば、いきなり上位に踊り出ることができる。できればの話であるが。
</p>

<p>
競技開始から一時間も立つと、手を動かしている人はまばらになった。何やら紙に書いたり、手で頭をおさえて顔をしかめながら虚空を見つめている人が多い。なんとか解法をひねり出そうをしているのだろうか。chokudai御仁によれば、どのような解法を適用すべきか見当がついていない人もいるので、例えばここで適切な解法の名称をぽろりと言ってしまうと、大いなるヒントとなり得るのだという。
</p>

<p>
さて、いよいよ残り時間が少ない。あと6分ぐらいだ。とそこへ、chokudai御仁がうなり声を上げた。一体何が起こったのか。提出された解答の一覧を見ると、なぜかある一人の参加者が、同じ問題に短時間で何十回も提出を繰り返しているではないか。コードを眺めたchokudai御仁が一言、
</p>

<p>
「rand使ってます」
</p>

<p>
その瞬間、全員の顔がニヤリとゆがんで爆笑が起こった。
</p>

<p>
要するに、入力に対して正解となる出力ができればいいのだ。その出力をどのようにして行ったかというのは、どうでもいいことなのだ。たとえそれが、たまたま正解に一致する乱数列であったとしても。
</p>

<p>
ただし、さらに詳しく調べたchokudai御仁によれば、これは全くの博打でもないようだ。というのも、この大量提出者の書いたコードは、一部のテストケースで制限時間に引っかかる十分に速度の出ない実装であるので、実行時間を計測して、あまりに時間がかかる場合だけ乱数を返すようにしてあった。chokudai御仁によれば、まっとうな方法の過去の提出で時間切れで失敗しているテストケースの数を考えると、乱数に頼る部分はそれほど多くなく、1/64ぐらいの確率で通ってしまうのではないかとのことであった。のこり5分ならばやる価値のある博打である。
</p>

<p>
そして、この博打はうまくいった。なんと、無事にテストに通過した提出があったのだ。実に熱い展開であった。
</p>

<p>
一言だけ付け加えておくと、Cの標準ライブラリのrand()は、C++では非推奨扱いになっている。C++11には新しい乱数ライブラリである&lt;random&gt;があり、C++17に向けてrand_intというrandのように使いやすくて安全なライブラリも提案されているので、そちらを使うべきである。もちろん、このときのAtCoderの環境はGCC 4.8なので、最新のC++14の機能をあますことなく使えるというわけではないのだが。どうやら、AtCoderは近々C++コンパイラーの更新を予定しているらしい。
</p>

<p>
さて、競技は終了した。ほぼ全員が解答にC++を使っていたので、懇親会で色々と気になることを聞いてみた。
</p>

<p>
まず、どのようなC++11の新機能を使っているのか。参加者全員が共通して答えた機能は、Range-based forであった。
</p>

<pre><code>int main()
{
    std::vector&lt;int&gt; v{ 1, 2, 3, 5, 6, 7, 8, 9 } ;

    for ( auto &amp;&amp; elem : v )
    {
        std::cout &lt;&lt; elem &lt;&lt; std::endl ;
    }
}
</code></pre>

<p>
range-based forがもてはやされるのには理由がある。もちろん、コンテナーのすべての要素に対して何らかの処理をしたい場合はよくあるのだが、その最大の理由は、自分でイテレーターを使う必要がないという点である。range-based forを使わないと、以下のように書くのだが
</p>

<pre><code>for ( auto iter = v.begin(), end = v.end() ; iter != end ; ++iter )
{
    std::cout &lt;&lt; *iter &lt;&lt; std::endl ;
}
</code></pre>

<p>
これはバグの元である。人間が手でこのように書いて間違わないわけがない。競技プログラミングにおいて時間はとても貴重であり、くだらないtypoのために何分もデバッグに費やすようなことは大変に痛い時間の浪費である。
</p>

<p>
これにつけて言及すべき、競技プログラミング特有のC++のテクニックがある。競技プログラミングの解答であるソースコードは、大抵がまずよく使うヘッダーファイル群の#includeに始まり、数十行の、極めて特徴的なプリプロセッサーマクロの定義が続く。
</p>

<p>
たとえば、以下のようなマクロ
</p>

<pre><code>#define ll long long
#define ull unsigned long long

long long a = 0 ; // だるい
ll b = 0 ; // 楽
</pre></code>

<p>
あるいは以下のようなマクロ
</p>

<pre><code>#define pb push_back

int main()
{
    std::vector&lt;int&gt; v ;

    v.push_back( 1 ) ; // だるい
    v.pb( 2 ) ; // 楽
}
</code></pre>

<p>
長い識別子は打つのに時間がかかり、typoの元でもある。
</p>

<p>
このような単純な置き換えはまだいいものの、以下のようなマクロまである。
</p>


<pre><code>#define rep(i,n) for (int i=0;i&lt;(n);i++)

int main()
{
    int a[10] ;

    // だるい
    for ( int i = 0 ; i &lt; 10 ; ++i )
        a[i] = i ;

    // 楽
    rep( i, 10 )
        a[i] = i ;
    
}
</code></pre>

<p>
あるいは以下のようなマクロ
</p>

<pre><code>#define all(a) (a).begin(),(a).end()

int main()
{
    std::vector&lt;int&gt; v = { 1, 2, 3, 4, 5, 6, 7, 8, 9 } ;

    {// だるい
        int sum = 0 ;
        std::for_each( v.begin(), v.end, [&amp;](auto x){ sum += x ; } ) ;
    }

    {// 楽
        int sum = 0 ;
        std::for_each( all(v), [&amp;](auto x){ sum += x ; } ) ;
    }
}
</code></pre>

<p>
競技プログラマーとしては、できるだけこのような機械的な人間が間違える可能性のあるコードは書きたくないのだろう。
</p>

<p>
ただ、この中でrepがとても気になる。指定した回数ループするというのはよくある処理に思える。なぜC++はそのような文法を提供していないのか。ライブラリで十分に出来ることに。
</p>

<pre><code>template &lt; typename Integer, typename Func &gt;
void rep( Integer count, Func func )
{
    for ( Integer i = 0 ; i != count ; ++i )
    {
        func(i) ;
    }
}
 
int main()
{
    int a[10] ;
    rep( 10, [&amp;](auto i){ a[i] = i ; } ) ;
}
</code></pre>

<p>
とはいえ、やはりラムダ式が冗長に見えるかもしれない。
</p>

<p>
C++に欲しい機能としては、全員が何はともかく無限精度整数を挙げた。たしかに、いい加減に標準ライブラリに存在すべきであると思う。
</p>

<p>
さて、16新卒枠の中で、ドワンゴの求人応募で、最終面接までのパススルー権を獲得した人が出たそうだ。その権利を実際に行使するのだろうか。
</p>

<div class="dwango-ad">
<p>
ドワンゴ広告
</p>

<p>
ドワンゴは本物のC++プログラマーを募集しています。
</p>

<p>
<a href="http://info.dwango.co.jp/recruit/">採用情報｜株式会社ドワンゴ</a>
</p>

<p>
CC BY-ND 4.0: <a href="http://creativecommons.org/licenses/by-nd/4.0/deed.en_US">Creative Commons — Attribution-NoDerivatives 4.0 International — CC BY-ND 4.0</a>
</p>

</div>

</article>

<footer>
<p>
Unless otherwise noted,<br>
<br>
Copyright (C) 2014 江添亮<br>
<br>
Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
</p>
</footer>
</body>
</html>
